# Модель песчаной кучи

## Описание
Программа моделирует поведение песчаной кучи и сохраняет состояния в BMP-изображениях.

## Использование

./SandPile -w ШИРИНА -l ВЫСОТА -i ВХОДНОЙ_ФАЙЛ -o ПАПКА_ВЫВОДА -m МАКС_ИТЕРАЦИЙ [-f ЧАСТОТА]

### Параметры:
- `-w` или `--width`: Ширина сетки (число столбцов) - обязательно
- `-l` или `--length`: Высота сетки (число строк) - обязательно
- `-i` или `--input`: Файл с начальным состоянием в формате TSV - обязательно
- `-o` или `--output`: Папка для сохранения картинок - обязательно
- `-m` или `--max-iter`: Максимальное число шагов моделирования - обязательно
- `-f` или `--freq`: Как часто сохранять картинки (0 - только итог) - необязательно

### Формат входного файла:
В файле должны быть строки вида:  
`X_КООРДИНАТА<TAB>Y_КООРДИНАТА<TAB>КОЛИЧЕСТВО_ПЕСЧИНОК`

Пример:  
`1<TAB>2<TAB>5` - значит в ячейку (1,2) положить 5 песчинок

### Что сохраняется:
- Если указана частота (`-f`), будут файлы `step_1.bmp`, `step_2.bmp` и т.д.
- Всегда сохраняется `final.bmp` с итоговым состоянием

### Цвета в картинках:
- 0 песчинок - белый
- 1 песчинка - зелёный
- 2 песчинки - фиолетовый
- 3 песчинки - жёлтый
- 4 и больше - чёрный
# Описание работы программы

## Основные компоненты программы

### 1. Инициализация (функция `loadInitialState`)
- Читает TSV-файл построчно
- Для каждой строки:
  - Парсит координаты (x,y) и количество песчинок
  - Проверяет корректность координат
  - Заполняет сетку `grid[y][x] = количество_песчинок`

### 2. Моделирование (функция `topple`)
- Создает копию текущего состояния (`newGrid`)
- Для каждой ячейки:
  - Если значение ≥ 4 (`grid[y][x] >= 4`):
    - Уменьшает значение на 4 (`newGrid[y][x] -= 4`)
    - Увеличивает соседей на 1 (если сосед существует)
- Заменяет текущую сетку на новую (`grid = newGrid`)

### 3. Проверка стабильности (функция `isStable`)
- Проходит по всем ячейкам сетки
- Возвращает `false`, если найдена хотя бы одна ячейка с ≥4 песчинок
- Возвращает `true`, если все ячейки содержат ≤3 песчинок

### 4. Сохранение состояния (функция `saveBMP`)
- Создает BMP-файл с заголовком (54 байта)
- Для каждой строки сетки (снизу вверх):
  - Для каждого пикселя:
    - Определяет цвет по количеству песчинок (`getColor`)
    - Записывает 3 байта (BGR-формат)
  - Добавляет выравнивание (до 4 байт)

## Главный цикл (в `main`)
1. Создает выходную директорию (`fs::create_directories`)
2. Инициализирует сетку (`loadInitialState`)
3. Запускает цикл моделирования:
   ```cpp
   for (uint64_t iter = 1; iter <= max_iter; ++iter) {
       topple(grid);
       if (freq > 0 && iter % freq == 0) {
           saveBMP(...);
       }
       if (isStable(grid)) break;
   }
